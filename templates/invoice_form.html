<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Create Invoice | A.R. Engineering</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        .amount-box {
            font-weight: bold;
            font-size: 18px;
        }
        .remove-row-btn {
            cursor: pointer;
            color: red;
            font-weight: bold;
        }
    </style>
</head>

<body class="bg-light">

    <div class="container mt-4">

        <h2 class="text-center mb-4">Create Invoice</h2>

        <form method="POST">

            <!-- TOP FIELDS -->
            <div class="row">
                <div class="col-md-6">
                    <label><b>Customer Name</b></label>
                    <input class="form-control" name="customer_name" required>
                </div>

                <div class="col-md-3">
                    <label><b>Invoice No</b></label>
                    <input class="form-control" name="gst_invoice_no" id="invoice_no" readonly>
                </div>

                <div class="col-md-3">
                    <label><b>Date</b></label>
                    <input type="date" class="form-control" name="date" required>
                </div>
            </div>

            <div class="row mt-3">
                <div class="col-md-4">
                    <label><b>Party GST Number</b> (Optional)</label>
                    <input class="form-control" name="party_gst" placeholder="Enter GST No">
                </div>
            </div>

            <hr>

            <!-- ITEMS TABLE -->
            <h4>Items</h4>
            <table class="table table-bordered" id="items-table">
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>HSN</th>
                        <th>Qty</th>
                        <th>Rate</th>
                        <th>Amount</th>
                        <th>Remove</th>
                    </tr>
                </thead>

                <tbody>
                    <tr>
                        <td><input class="form-control" name="description[]" required></td>
                        <td><input class="form-control" name="hsn_code[]"></td>
                        <td><input type="number" name="quantity[]" class="form-control qty" min="1" step="1"
                                value="1"></td>
                        <td><input type="number" name="rate[]" class="form-control rate" step="0.01"
                                value="0.00"></td>
                        <td class="amount">0.00</td>
                        <td class="text-center">—</td>
                    </tr>
                </tbody>
            </table>

            <button type="button" id="add-row" class="btn btn-outline-primary">+ Add Item</button>

            <h4 class="text-end mt-3">Sub Total: ₹ <span id="total">0.00</span></h4>

            <hr>

            <!-- TAX SECTION -->
            <div class="row">
                <div class="col-md-4">
                    <label>CGST %</label>
                    <input class="form-control" name="cgst_rate" id="cgst_rate" value="9">
                </div>
                <div class="col-md-4">
                    <label>SGST %</label>
                    <input class="form-control" name="sgst_rate" id="sgst_rate" value="9">
                </div>

                <div class="col-md-4">
                    <label><b>Grand Total</b></label>
                    <input class="form-control amount-box" id="grand_total_display" readonly>
                </div>
            </div>

            <input type="hidden" name="grand_total" id="grand_total">

            <hr>

            <!-- BANK SECTION -->
            <h4>Bank Details</h4>
            <div class="row">
                <div class="col-md-6">
                    <label>Bank Name</label>
                    <input class="form-control" name="bank_name" required>
                </div>

                <div class="col-md-6">
                    <label>Branch</label>
                    <input class="form-control" name="branch" required>
                </div>

                <div class="col-md-6 mt-2">
                    <label>Account No</label>
                    <input class="form-control" name="account_no" required>
                </div>

                <div class="col-md-6 mt-2">
                    <label>IFSC</label>
                    <input class="form-control" name="ifsc" required>
                </div>
            </div>

            <div class="text-center mt-4">
                <button type="submit" class="btn btn-success btn-lg">Generate Invoice PDF</button>
            </div>

        </form>

    </div>

    <script>
        // Auto-generate random invoice number
        function generateInvoiceNo() {
            let randomNum = Math.floor(100000 + Math.random() * 900000);
            let invoice = "ARINV-" + randomNum;
            $("#invoice_no").val(invoice);
        }
        generateInvoiceNo();

        // Add item row
        $("#add-row").click(() => {
            $("#items-table tbody").append(`
                <tr>
                    <td><input class="form-control" name="description[]" required></td>
                    <td><input class="form-control" name="hsn_code[]"></td>
                    <td><input type="number" name="quantity[]" class="form-control qty" min="1" step="1" value="1"></td>
                    <td><input type="number" name="rate[]" class="form-control rate" step="0.01" value="0.00"></td>
                    <td class="amount">0.00</td>
                    <td class="text-center remove-row-btn">❌</td>
                </tr>
            `);
        });

        // Remove row
        $(document).on("click", ".remove-row-btn", function () {
            $(this).closest("tr").remove();
            calculateTotal();
        });

        // Recalculate totals
        function calculateTotal() {
            let total = 0;

            $("#items-table tbody tr").each(function () {
                let qty = parseFloat($(this).find(".qty").val()) || 0;
                let rate = parseFloat($(this).find(".rate").val()) || 0;
                let amt = qty * rate;

                $(this).find(".amount").text(amt.toFixed(2));
                total += amt;
            });

            $("#total").text(total.toFixed(2));

            let cgst = (parseFloat($("#cgst_rate").val()) || 0) * total / 100;
            let sgst = (parseFloat($("#sgst_rate").val()) || 0) * total / 100;

            let grand_total = total + cgst + sgst;

            $("#grand_total_display").val("₹ " + grand_total.toFixed(2));
            $("#grand_total").val(grand_total.toFixed(2));
        }

        $(document).on("input", ".qty, .rate, #cgst_rate, #sgst_rate", calculateTotal);
    </script>

</body>

</html>
